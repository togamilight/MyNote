# 第一章 了解 Web 及网络基础

## 1.3 网络基础 TCP/IP

通常使用的网络（包括互联网）是在 TCP/IP 协议族的基础上运作的，HTTP 是它的一个子集。

### 1.3.2 TCP/IP 的分层管理

TCP/IP 协议族分为 4 层（从上到下）：
* **应用层**：决定了向用户提供应用服务时通信的活动；TCP/IP 协议族内预存了各类通用的应用服务，如 FTP（File Transfer Protocol，文件传输协议） 和 DNS（Domain Name System，域名系统） 服务。HTTP 属于这一层
* **传输层**：提供处于网络连接中的两台计算机之间的数据传输；传输层有两个性质不同的协议：TCP（Transmission Control Protocol，传输控制协议） 和 UDP（User Data Protocol，用户数据报协议）
* **网络层**：又名**网络互连层**，处理在网络上流动的数据包（数据包是网络传输最小单位），规定了通过怎样的传输路线到达对方计算机，并传送数据包，即在与对方机器间的众多计算机或网络设备中选择一条传输路线。IP（Internet Protocol，网际协议）属于这一层
* **链路层**：又名**数据链路层、网络接口层**，处理连接网络的硬件部分，包括控制操作系统、硬件的设备驱动、网卡及光纤等物理可见部分（还包括连接器等一切传输媒介）

在 HTTP 协议中，原始的 HTTP 数据，每经过一层，就会附加上该层对应的**首部**，称为**封装**，到达接收端再一层一层拆开，还原成 HTTP 数据：
应用层生成 HTTP 数据 → 传输层附加 TCP 首部 → 网络层附加 IP 首部 → 链路层附加以太网首部

## 1.4 与 HTTP 关系密切的协议：IP、TCP 和 DNS

### 1.4.1 负责传输的 IP

IP（Internet Protocol，网际协议）位于**网络层**，负责把各种数据包传送给对方，需要 IP 地址 和 MAC 地址（Media Access Control Address）  
IP 地址是可变的，MAC 地址是网卡的固定地址，一般不变，它们之间可以进行配对，使用 ARP（Address Resolution Protocol，地址解析协议）根据 IP 地址反查 MAC 地址  
传输过程中，中转设备只能获悉很粗略的传输路线，通过 MAC 地址将数据传给下一个中转设备，这种机制称为**路由选择**

### 1.4.2 确保可靠性的 TCP

TCP 位于传输层，提供可靠的字节流服务  
* **字节流服务**：为方便传输，将大块数据分割成以报文段（Segment）为单位的数据包进行管理。  
* **可靠性**：数据包发送之后，TCP 会确认数据是否送达，通过**三次握手**策略，使用了 TCP 的标志 -- SYN(synchronize) 和 ACK(acknowledgement)
    * **三次握手**：
        1. 发送端先发送一个带 SYN 标志的数据包给对方
        2. 接收方收到后，回复一个带有 SYN/ACK 标志的数据包表示传达确认信息
        3. 发送端再回复一个带 ACK 标志的数据包，代表“握手”结束
        * 如果握手过程中某个阶段突然中断，TCP 会再次以相同顺序发送相同数据包
    * 除了三次握手，TCP 还有其它各种手段保证通信的可靠性

## 1.5 负责域名解析的 DNS 服务

DNS 服务位于应用层，提供域名到 IP 地址间的解析服务，从 DNS 服务器通过域名查找 IP 地址或从 IP 地址反查域名